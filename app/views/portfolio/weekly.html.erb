<h1 class="mb-4">Weekly Consumption Data</h1>

<%= form_with url: portfolio_weekly_path, method: :get, local: true, class: 'mb-4' do %>
  <div class="form-group">
    <label for="week_start" class="form-label">Select Week Start Date:</label>
    <%= date_field_tag :week_start, params[:week_start] || Date.today.beginning_of_week(:sunday).to_s, class: 'form-control' %>
  </div>
  <div class="form-group">
    <%= submit_tag "Show Week", class: 'btn btn-primary' %>
  </div>
<% end %>

<div>
  <p>Selected Week Range:</p>
  <% start_date = Date.parse(params[:week_start] || Date.today.beginning_of_week(:sunday).to_s) %>
  <% end_date = start_date.end_of_week(:saturday) %>
  <p><%= "#{start_date.strftime('%b %d')} - #{end_date.strftime('%b %d')}" %></p>
</div>

<%= bar_chart @consumptions_data,
  class: 'box',
  theme: 'sakura',
  options: {
    series: {
      barWidth: '50%'
    },
    tooltip: {
      valueFormatter: RailsCharts.js("(value) => Math.round(value) + ' kcal'")
    }
  }
%>
